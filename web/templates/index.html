{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-12 col-lg-8">
    <div class="card shadow-sm border-0">
      <div class="card-body p-4">
        <h2 class="h4 mb-4">Obtén recomendaciones</h2>
        <form id="recoForm" class="row g-3 align-items-end" onsubmit="getRecommendations(event)">
          <div class="col-sm-6">
            <label for="userId" class="form-label">ID de usuario</label>
            <input id="userId" name="userId" type="number" min="1" required class="form-control form-control-lg" placeholder="Ej. 1" />
          </div>
          <div class="col-sm-auto">
            <button class="btn btn-primary btn-lg px-4" type="submit">Generar recomendaciones</button>
          </div>
        </form>
      </div>
    </div>

    <div class="card shadow-sm border-0 mt-4 d-none" id="resultsCard">
      <div class="card-body p-4">
        <h3 class="h5 mb-3">Películas recomendadas</h3>
        <div id="resultsContent" class="text-muted">Cargando...</div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
async function getRecommendations(event) {
  event.preventDefault();
  const userId = document.getElementById("userId").value.trim();
  const card = document.getElementById("resultsCard");
  const content = document.getElementById("resultsContent");
  card.classList.remove("d-none");
  content.innerHTML = "Cargando...";
  try {
    const res = await fetch(`/api/recommend?userId=${encodeURIComponent(userId)}`);
    if (!res.ok) throw new Error("HTTP " + res.status);
    const data = await res.json();
    const recs = Array.isArray(data.recommendations) ? data.recommendations : [];
    if (recs.length === 0) {
      content.innerHTML = "<p>No se encontraron recomendaciones para este usuario.</p>";
      return;
    }
    const list = recs.map(r => (
      `<li class="list-group-item d-flex justify-content-between align-items-center">
         <span>${r.movieTitle}</span>
         <span class="badge bg-success-subtle text-success-emphasis rounded-pill">Score: ${Number(r.score).toFixed(2)}</span>
       </li>`
    )).join("");
    content.innerHTML = `<ul class="list-group list-group-flush">${list}</ul>`;
  } catch (e) {
    content.innerHTML = "<p class='text-danger'>Error obteniendo recomendaciones.</p>";
  }
}
</script>
{% endblock %}
